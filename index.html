<!DOCTYPE html>
<html lang="ru" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –¥–µ—Ä–µ–≤–æ - Apache Superset Embed</title>
    
    <meta http-equiv="Content-Security-Policy" 
          content="default-src 'self' https://cdn.jsdelivr.net; 
                   style-src 'self' 'unsafe-inline';
                   script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net;
                   img-src 'self' data: blob:;">
    
    <link rel="stylesheet" href="styles.css">
    
    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.4.4/libs/lz-string.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    
</head>

<body class="transition-colors duration-300">
    <div id="debug-panel" style="position: fixed; top: 10px; left: 10px; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 5px; font-size: 12px; z-index: 9999; max-width: 300px; display: none;">
        <div><strong>–°—Ç–∞—Ç—É—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:</strong></div>
        <div id="debug-status">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>
        <div id="debug-files">–§–∞–π–ª—ã: 0/6</div>
        <div id="debug-tree">–î–µ—Ä–µ–≤–æ: –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ</div>
        <button onclick="toggleDebug()" style="margin-top: 5px; font-size: 10px;">–°–∫—Ä—ã—Ç—å</button>
    </div>
    
    <div class="toggle-controls" id="toggleControls">‚â°</div>
    
    <div class="background-text">
        <h1>–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π –Ø–º–∞–ª–æ-–ù–µ–Ω–µ—Ü–∫–æ–≥–æ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–≥–æ –æ–∫—Ä—É–≥–∞</h1>
    </div>
    
    <div class="controls" id="controls">
        <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫..." style="padding: 8px; border-radius: 8px; border: 1px solid var(--primary-color);">
        <span id="selectedCount" style="margin-left: 10px; font-size: 0.9em; color: var(--accent-color); display: none;">–í—ã–¥–µ–ª–µ–Ω–æ: 0</span>
        <div class="autocomplete-suggestions" id="searchSuggestions"></div>
        
        <button type="button" id="saveCloudBtn" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–µ—Ä–µ–≤–æ –≤ GitHub">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –æ–±–ª–∞–∫–æ</button>
        <button type="button" id="loadCloudBtn" title="–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–µ—Ä–µ–≤–æ –∏–∑ GitHub">‚òÅÔ∏è –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –æ–±–ª–∞–∫–∞</button>
        <button type="button" id="shareLinkBtn" title="–°–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫—É –¥–ª—è –∫–æ–ª–ª–µ–≥">üîó –°–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
        
        <button type="button" id="jsonExportBtn">JSON –≠–∫—Å–ø–æ—Ä—Ç</button>
        <button type="button" id="jsonImportBtn">JSON –ò–º–ø–æ—Ä—Ç</button>
        <button type="button" id="saveBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ</button>
        
        <button type="button" id="collapseAllBtn">–°–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ</button>
        <button type="button" id="collapseParentBtn" class="collapse-parent-btn">–°–≤–µ—Ä–Ω—É—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—è</button>
        
        <button type="button" id="addSuperordinateAboveBtn">–î–æ–±–∞–≤–∏—Ç—å —Å–≤–µ—Ä—Ö—É</button>
        <button type="button" id="uploadFileBtn">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</button>
        
        <button type="button" id="mark269Btn">–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ 269-–ü</button>
        <button type="button" id="power269Btn">–ü–æ–ª–Ω–æ–º–æ—á–∏–µ –∏–∑ 269-–ü</button>
        <button type="button" id="subordinateBtn">–î–æ–ª–∂–Ω–æ—Å—Ç–Ω—ã–µ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—ã</button>
        <button type="button" id="forAllBtn">–í—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</button>
        <button type="button" id="authorityBtn">–ò–¥–µ–Ω—Ç–∏—á–Ω–æ–µ –ø–æ–ª–Ω–æ–º–æ—á–∏–µ</button>
        <button type="button" id="okrBtn">OKR</button>
        <button type="button" id="indicatorBtn">–ì–æ—Å. –ø—Ä–æ–≥—Ä–∞–º–º–∞</button>
        
        <div class="cluster-controls" style="display: flex; gap: 5px; align-items: center;">
            <select id="clusterSelect" style="padding: 8px; border-radius: 8px; border: 1px solid var(--primary-color); background: var(--controls-bg); color: var(--text-color);">
                <option value="">–í—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞</option>
            </select>
            <button id="addToClusterBtn" title="–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–ª–∞—Å—Ç–µ—Ä">üè∑Ô∏è</button>
        </div>
        
        <button type="button" id="zoomInBtn">+</button>
        <button type="button" id="zoomResetBtn" class="reset-zoom-btn" title="–°–±—Ä–æ—Å–∏—Ç—å –º–∞—Å—à—Ç–∞–± –∏ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º —É–∑–ª–µ">‚≠ï</button>
        <button type="button" id="zoomOutBtn">-</button>
        
        <div class="theme-switch" id="themeSwitch">
            <span class="theme-icon sun-icon">‚òÄÔ∏è</span>
            <span class="theme-icon moon-icon">üåô</span>
            <div class="theme-switch-handle"></div>
            <div class="theme-transition-overlay" id="themeTransitionOverlay"></div>
        </div>
    </div>
    
    <div class="drop-zone" id="dropZone">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞</div>
    
    <div id="tree" class="tree">
        <div id="tree-loading" style="padding: 50px; text-align: center; color: var(--text-color);">
            <div style="font-size: 24px; margin-bottom: 20px;">‚è≥</div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ—Ä–µ–≤–∞...</p>
            <p id="loading-details" style="font-size: 12px; color: #666;"></p>
        </div>
    </div>
    
    <div class="image-preview-container" id="previewContainer">
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=" class="image-preview" id="fullPreview">
    </div>
    
    <div class="watermark">Interactive Tree v9.2</div>
    <div class="history-log-icon" id="historyLogIcon" title="–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π">üïí</div>
    
    <div class="history-dialog-backdrop" id="historyDialogBackdrop">
        <div class="history-dialog">
            <h3>–ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π</h3>
            <ul class="history-list" id="historyList"></ul>
            <button class="history-dialog-close" id="historyDialogClose">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
    
    <div class="department-management" id="departmentManagement">
        <div class="department-header">
            <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª–∞–º–∏</h2>
            <button id="closeDepartmentManagement">√ó –ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
        <div class="department-container" id="departmentContainer"></div>
    </div>
    
    <div id="tooltip-container" class="tooltip" style="display: none;"></div>

    <script>
    console.log('=== –ù–ê–ß–ê–õ–û –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–ò –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ===');
    
    window.appState = {
        scripts: {},
        loadedCount: 0,
        isInitialized: false,
        debugMode: true
    };
    
    function toggleDebug() {
        const panel = document.getElementById('debug-panel');
        panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
    }
    
    function updateDebugStatus(status, color = 'white') {
        const statusEl = document.getElementById('debug-status');
        if (statusEl) {
            statusEl.textContent = status;
            statusEl.style.color = color;
        }
    }
    
    function updateFileCount() {
        const filesEl = document.getElementById('debug-files');
        if (filesEl) {
            filesEl.textContent = `–§–∞–π–ª—ã: ${window.appState.loadedCount}/6`;
        }
    }
    
    function updateTreeStatus(status) {
        const treeEl = document.getElementById('debug-tree');
        if (treeEl) {
            treeEl.textContent = `–î–µ—Ä–µ–≤–æ: ${status}`;
        }
    }
    
    function updateLoadingDetails(text) {
        const detailsEl = document.getElementById('loading-details');
        if (detailsEl) {
            detailsEl.textContent = text;
        }
    }

    function loadScript(src, priority = 'normal') {
        return new Promise((resolve, reject) => {
            console.log(`üîÑ –ó–∞–≥—Ä—É–∑–∫–∞: ${src} (${priority})`);
            
        
            const pathsToTry = [
                src,                   
                '/' + src,              
                './' + src,             
                window.location.pathname.split('/').slice(0, -1).join('/') + '/' + src 
            ];
            
            let currentPathIndex = 0;
            
            function tryLoad(path) {
                const script = document.createElement('script');
                script.src = path;
                
                script.onload = () => {
                    console.log(`‚úÖ –£—Å–ø–µ—à–Ω–æ: ${src} (–∑–∞–≥—Ä—É–∂–µ–Ω —Å ${path})`);
                    window.appState.scripts[src] = 'loaded';
                    window.appState.loadedCount++;
                    updateFileCount();
                    updateLoadingDetails(`–ó–∞–≥—Ä—É–∂–µ–Ω: ${src}`);
                    resolve();
                };
                
                script.onerror = () => {
                    currentPathIndex++;
                    if (currentPathIndex < pathsToTry.length) {
                        console.log(`üîÑ –ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø—É—Ç—å –¥–ª—è ${src}: ${pathsToTry[currentPathIndex]}`);
                        tryLoad(pathsToTry[currentPathIndex]);
                    } else {
                        console.error(`‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å: ${src}`);
                        window.appState.scripts[src] = 'failed';
                        window.appState.loadedCount++;
                        updateFileCount();
                        
                        if (priority === 'critical') {
                            reject(new Error(`–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç ${src} –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω`));
                        } else {
                            console.warn(`–ù–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–π —Å–∫—Ä–∏–ø—Ç ${src} –ø—Ä–æ–ø—É—â–µ–Ω`);
                            resolve();
                        }
                    }
                };
                
                document.body.appendChild(script);
            }
            
            tryLoad(pathsToTry[0]);
        });
    }
    
    
    async function checkFileAvailability(filename) {
        try {
            const response = await fetch(filename, { method: 'HEAD' });
            return response.ok;
        } catch (e) {
            return false;
        }
    }
    

    async function initializeApp() {
        console.log('üöÄ –ó–∞–ø—É—Å–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è');
        updateDebugStatus('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤...', '#FFA500');
        
        
        document.getElementById('debug-panel').style.display = 'block';
        
        try {
           
            updateLoadingDetails('–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤...');
            const filesToCheck = [
                'node-effects.js',
                'indexed-db-manager.js',
                'tree-manager-core.js',
                'tree-storage.js',
                'tree-cloud.js',
                'main.js'
            ];
            
            for (const file of filesToCheck) {
                const isAvailable = await checkFileAvailability(file);
                console.log(`${file}: ${isAvailable ? '‚úÖ –¥–æ—Å—Ç—É–ø–µ–Ω' : '‚ùå –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω'}`);
            }
            
         
            updateDebugStatus('–ó–∞–≥—Ä—É–∑–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤...', '#2196F3');
            updateLoadingDetails('–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π...');
            
          
            await loadScript('node-effects.js', 'critical');
            await loadScript('indexed-db-manager.js', 'critical');
            await loadScript('tree-manager-core.js', 'critical');
            
            
            updateLoadingDetails('–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±–ª–∞—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π...');
            await loadScript('tree-storage.js', 'normal');
            await loadScript('tree-cloud.js', 'normal');
            
       
            updateLoadingDetails('–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
            await loadScript('main.js', 'critical');
            
            console.log('‚úÖ –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
            updateDebugStatus('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π...', '#4CAF50');
            updateLoadingDetails('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ—Ä–µ–≤–∞...');
            
           
            setTimeout(() => {
              
                const requiredFunctions = [
                    'treeApp',
                    'initCloudStorage',
                    'saveTreeToCloud',
                    'loadTreeFromCloud'
                ];
                
                console.log('=== –ü–†–û–í–ï–†–ö–ê –§–£–ù–ö–¶–ò–ô ===');
                requiredFunctions.forEach(func => {
                    console.log(`${func}: ${window[func] ? '‚úÖ –µ—Å—Ç—å' : '‚ùå –Ω–µ—Ç'}`);
                });
                
               
                if (window.treeApp && typeof window.treeApp.initialize === 'function') {
                    window.treeApp.initialize();
                    console.log('‚úÖ treeApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                } else if (typeof initTreeApp === 'function') {
                    initTreeApp();
                    console.log('‚úÖ initTreeApp –≤—ã–∑–≤–∞–Ω');
                }
                
             
                if (typeof window.initCloudStorage === 'function') {
                    setTimeout(() => {
                        window.initCloudStorage();
                        console.log('‚úÖ –û–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
                    }, 500);
                }
                
           
                const loadingEl = document.getElementById('tree-loading');
                if (loadingEl) {
                    loadingEl.style.display = 'none';
                }
                
              
                checkAutoLoad();
                
            
                window.appState.isInitialized = true;
                updateDebugStatus('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ', '#4CAF50');
                updateTreeStatus('–∑–∞–≥—Ä—É–∂–µ–Ω–æ');
                
                console.log('=== –ü–†–ò–õ–û–ñ–ï–ù–ò–ï –£–°–ü–ï–®–ù–û –ò–ù–ò–¶–ò–ê–õ–ò–ó–ò–†–û–í–ê–ù–û ===');
                
            }, 1000);
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
            updateDebugStatus('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏', '#F44336');
            updateLoadingDetails(`–û—à–∏–±–∫–∞: ${error.message}`);
            
            showErrorMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
        }
    }

    function checkAutoLoad() {
        console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const treeParam = urlParams.get('tree');
        const dataParam = urlParams.get('data');
        
        if (treeParam || dataParam) {
            console.log('üì• –ù–∞–π–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –≤ URL, –∑–∞–ø—É—Å–∫ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏...');
            updateLoadingDetails('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å—Å—ã–ª–∫–∏...');
            
            setTimeout(() => {
                if (typeof window.autoLoadTreeOnStart === 'function') {
                    window.autoLoadTreeOnStart();
                } else {
                    console.warn('–§—É–Ω–∫—Ü–∏—è autoLoadTreeOnStart –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }
            }, 1500);
        } else {
            console.log('üì≠ –î–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
        }
    }

    function showErrorMessage(message) {
        const errorDiv = document.createElement('div');
        errorDiv.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #F44336;
            color: white;
            padding: 20px;
            border-radius: 10px;
            z-index: 10000;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        `;
        
        errorDiv.innerHTML = `
            <h3 style="margin-top: 0;">‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h3>
            <p>${message}</p>
            <div style="margin-top: 15px;">
                <button onclick="location.reload()" style="padding: 8px 16px; background: white; color: #F44336; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px;">
                    –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
                </button>
                <button onclick="document.getElementById('debug-panel').style.display='block'" style="padding: 8px 16px; background: transparent; color: white; border: 1px solid white; border-radius: 4px; cursor: pointer;">
                    –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–ª–∞–¥–∫—É
                </button>
            </div>
        `;
        
        document.body.appendChild(errorDiv);
    }
    
    function setupCloudButtons() {
        console.log('üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –æ–±–ª–∞—á–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫...');
        
        const saveBtn = document.getElementById('saveCloudBtn');
        const loadBtn = document.getElementById('loadCloudBtn');
        const shareBtn = document.getElementById('shareLinkBtn');
        
        if (saveBtn) {
            saveBtn.onclick = function(e) {
                if (typeof saveTreeToCloud === 'function') {
                    saveTreeToCloud.call(this, e);
                } else {
                    alert('–û–±–ª–∞—á–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ–º–Ω–æ–≥–æ.');
                }
            };
        }
        
        if (loadBtn) {
            loadBtn.onclick = function(e) {
                if (typeof loadTreeFromCloud === 'function') {
                    loadTreeFromCloud.call(this, e);
                } else {
                    alert('–û–±–ª–∞—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ–º–Ω–æ–≥–æ.');
                }
            };
        }
        
        if (shareBtn) {
            shareBtn.onclick = function(e) {
                if (typeof shareTreeLink === 'function') {
                    shareTreeLink.call(this, e);
                } else {
                    alert('–°–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ–º–Ω–æ–≥–æ.');
                }
            };
        }
    }
    
    window.appDebug = {
        reload: function() {
            location.reload();
        },
        checkState: function() {
            console.log('=== –°–û–°–¢–û–Ø–ù–ò–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ===');
            console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ:', window.appState.isInitialized);
            console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–æ —Å–∫—Ä–∏–ø—Ç–æ–≤:', window.appState.loadedCount);
            console.log('–°–∫—Ä–∏–ø—Ç—ã:', window.appState.scripts);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–µ—Ä–µ–≤–æ
            const treeEl = document.getElementById('tree');
            console.log('–≠–ª–µ–º–µ–Ω—Ç –¥–µ—Ä–µ–≤–∞:', treeEl);
            console.log('–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–µ—Ä–µ–≤–∞:', treeEl ? treeEl.innerHTML.length + ' —Å–∏–º–≤–æ–ª–æ–≤' : '–Ω–µ—Ç');
        },
        testCloud: function() {
            console.log('=== –¢–ï–°–¢ –û–ë–õ–ê–ß–ù–´–• –§–£–ù–ö–¶–ò–ô ===');
            console.log('saveTreeToCloud:', typeof saveTreeToCloud);
            console.log('loadTreeFromCloud:', typeof loadTreeFromCloud);
            console.log('shareTreeLink:', typeof shareTreeLink);
            console.log('TreeStorage:', typeof TreeStorage);
            console.log('treeStorage:', typeof treeStorage !== 'undefined' ? '–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω' : '–Ω–µ—Ç');
        }
    };

    document.addEventListener('DOMContentLoaded', function() {
        console.log('üìÑ DOM –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω');
        
        setupCloudButtons();
        
        setTimeout(() => {
            initializeApp();
        }, 100);
    });
    
    setTimeout(() => {
        if (!window.appState.isInitialized) {
            console.warn('‚ö†Ô∏è –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–≥–æ –≥—Ä—É–∑–∏—Ç—Å—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º fallback...');
            updateDebugStatus('–ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞', '#FF9800');
            updateLoadingDetails('–ü–æ–ø—ã—Ç–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è...');
            
            const treeEl = document.getElementById('tree');
            if (treeEl && treeEl.children.length === 1) { // —Ç–æ–ª—å–∫–æ loading —Å–æ–æ–±—â–µ–Ω–∏–µ
                treeEl.innerHTML += `
                    <div style="padding: 20px; background: #f5f5f5; border-radius: 8px; margin-top: 20px;">
                        <h3>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</h3>
                        <p>–ï—Å–ª–∏ –¥–µ—Ä–µ–≤–æ –Ω–µ –ø–æ—è–≤–∏–ª–æ—Å—å, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ:</p>
                        <ul>
                            <li>–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)</li>
                            <li>–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞</li>
                            <li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å JSON –∏–º–ø–æ—Ä—Ç</li>
                        </ul>
                        <button onclick="location.reload()" style="padding: 10px 20px; background: var(--primary-color); color: white; border: none; border-radius: 5px; cursor: pointer;">
                            –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
                        </button>
                    </div>
                `;
            }
        }
    }, 10000); 
    
    </script>
</body>
</html>
